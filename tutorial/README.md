In this tutorial, dpMD is applied to [Lysozyme](https://www.rcsb.org/structure/3LZT), a classical example.
dpMD was implemented to extract the best of two worlds: [CHARMM](https://www.charmm.org/) is used for normal mode calculations and file processing, while [NAMD](http://www.ks.uiuc.edu/Research/namd/) is used as MD engine.
All necessary [inputs](https://github.com/antonielgomes/dpMD/tree/main/tutorial/inputs) and [scripts](https://github.com/antonielgomes/dpMD/tree/main/tutorial/scripts) files can be downloaded for performing dpMD locally.

### System files
Before performing dpMD, the following input files for CHARMM and NAMD are required:
- NAMD equilibrated files:
  - Coordinates: `step6.coor` and `step6.pdb` (the last one can be generated with [CHARMM](https://www.charmm.org/) or [VMD](https://www.ks.uiuc.edu/Research/vmd/))
  - Velocities: `step6.vel`
  - Cell dimensions: `step6.xsc`
  - system:
- CHARMM parameter files:
  - Paramater files: `step1.psf` for the protein and `step3.psf` for the system
  - Stream file: `step3.str`
  - Crystal images: `crystal_image.str`
 - Topology files:
  -  The `toppar.str` stream file reads all topology files inside the [toppar](https://github.com/antonielgomes/dpMD/tree/main/tutorial/toppar/) directory.

All these files can be generate using the [CHARMM-GUI](https://www.charmm-gui.org/) server.


[modes](https://github.com/antonielgomes/dpMD/tree/main/tutorial/modes)

inputs  mdenm  modes  readme.txt  scripts  toppar  toppar.str  vmod
### Normal 


calculate normal modes
charmm -i scripts/normal-modes.inp

generate crd and dcd of modes:
charmm -i scripts/normal-modes-dcd-crd.inp nmodes=14

combine normal modes:
charmm -i scripts/normal-mode-combination.inp ncomb=6 nmodes=14 inputfile=./inputs/input-modes.txt



calculate `normal modes`
```
charmm -i scripts/normal-modes.inp
```

**PDIM** is also available in a compiled version for [Linux](https://github.com/soedinglab/MMseqs2/archive/71dd32ec43e3ac4dabf111bbc4b124f1c66a85f1.zip) and Windows.


generate crd and dcd of modes:
```
charmm -i scripts/normal-modes-dcd-crd.inp nmodes=20
```

generating normal mode combination
```
bash scripts/mdenm-modes-combination.sh
```

combine normal modes
```
charmm -i scripts/normal-mode-combination.inp ncomb=6
```

**VMOD**
```
scripts/runvmod-comb.sh = run vmod to obtain displaced conformations
```

**dpMD**

In this step, the equlibrated system will be driven towards all conformations generated by **VMOD**.

Initially, each conformation will be set as a target in the PDB format using `charmm`. In this example, six replicas were set in `nreps`:
```
charmm -i scripts/target.inp nreps=6
```
Following, TMD will be performed using `namd`:
```
bash scripts/tmd-namd.sh
```

```
charmm -i scripts/restraints.inp nreps=6
```

```
bash scripts/tmd-equil-namd.sh
```

```
bash scripts/tmd-free-md-namd.sh
```


### Bonus: **MDeNM**
```
scripts/mdenm-namd-exc.sh
```

```
scripts/mdenm-namd-md.sh
```

